use crate::base_printer::data::items::{Array, ArrayField, Field, Optimizations, Value};
use crate::base_printer::data::spells::tbc::assertions;
use crate::base_printer::write::items::GenericThing;
use rusqlite::Connection;

pub(crate) struct WrathSpell {
    id: u32,
    category: i32,
    dispel: i32,
    mechanic: i32,
    attributes: u32,
    attributes_ex: u32,
    attributes_ex2: u32,
    attributes_ex3: u32,
    attributes_ex4: u32,
    attributes_ex5: u32,
    attributes_ex6: u32,
    attributes_ex7: u32,
    stances: u32,
    stances2: u32,
    stances_not: u32,
    stances_not2: u32,
    targets: i32,
    target_creature_type: i32,
    requires_spell_focus: i32,
    facing_caster_flags: i32,
    caster_aura_state: i32,
    target_aura_state: i32,
    caster_aura_state_not: i32,
    target_aura_state_not: i32,
    caster_aura_spell: i32,
    target_aura_spell: i32,
    exclude_caster_aura_spell: i32,
    exclude_target_aura_spell: i32,
    casting_time_index: i32,
    recovery_time: i32,
    category_recovery_time: i32,
    interrupt_flags: i32,
    aura_interrupt_flags: u32,
    channel_interrupt_flags: u32,
    proc_flags: i32,
    proc_chance: i32,
    proc_charges: i32,
    max_level: i32,
    base_level: i32,
    spell_level: i32,
    duration_index: i32,
    power_type: u32,
    mana_cost: i32,
    mana_cost_per_level: i32,
    mana_per_second: i32,
    mana_per_second_per_level: i32,
    range_index: i32,
    speed: f32,
    modal_next_spell: i32,
    stack_amount: i32,
    totem1: i32,
    totem2: i32,
    reagent1: i32,
    reagent2: i32,
    reagent3: i32,
    reagent4: i32,
    reagent5: i32,
    reagent6: i32,
    reagent7: i32,
    reagent8: i32,
    reagent_count1: u32,
    reagent_count2: u32,
    reagent_count3: u32,
    reagent_count4: u32,
    reagent_count5: u32,
    reagent_count6: u32,
    reagent_count7: u32,
    reagent_count8: u32,
    equipped_item_class: i32,
    equipped_item_sub_class_mask: i32,
    equipped_item_inventory_type_mask: i32,
    effect1: i32,
    effect2: i32,
    effect3: i32,
    effect_die_sides1: i32,
    effect_die_sides2: i32,
    effect_die_sides3: i32,
    effect_real_points_per_level1: f32,
    effect_real_points_per_level2: f32,
    effect_real_points_per_level3: f32,
    effect_base_points1: i32,
    effect_base_points2: i32,
    effect_base_points3: i32,
    effect_mechanic1: i32,
    effect_mechanic2: i32,
    effect_mechanic3: i32,
    effect_implicit_target_a1: i32,
    effect_implicit_target_a2: i32,
    effect_implicit_target_a3: i32,
    effect_implicit_target_b1: i32,
    effect_implicit_target_b2: i32,
    effect_implicit_target_b3: i32,
    effect_radius_index1: i32,
    effect_radius_index2: i32,
    effect_radius_index3: i32,
    effect_apply_aura_name1: i32,
    effect_apply_aura_name2: i32,
    effect_apply_aura_name3: i32,
    effect_amplitude1: i32,
    effect_amplitude2: i32,
    effect_amplitude3: i32,
    effect_multiple_value1: f32,
    effect_multiple_value2: f32,
    effect_multiple_value3: f32,
    effect_chain_target1: i32,
    effect_chain_target2: i32,
    effect_chain_target3: i32,
    effect_item_type1: u32,
    effect_item_type2: u32,
    effect_item_type3: u32,
    effect_misc_value1: i32,
    effect_misc_value2: i32,
    effect_misc_value3: i32,
    effect_misc_value_b1: i32,
    effect_misc_value_b2: i32,
    effect_misc_value_b3: i32,
    effect_trigger_spell1: u32,
    effect_trigger_spell2: u32,
    effect_trigger_spell3: u32,
    effect_points_per_combo_point1: f32,
    effect_points_per_combo_point2: f32,
    effect_points_per_combo_point3: f32,
    effect_spell_class_mask1_1: u32,
    effect_spell_class_mask1_2: u32,
    effect_spell_class_mask1_3: u32,
    effect_spell_class_mask2_1: u32,
    effect_spell_class_mask2_2: u32,
    effect_spell_class_mask2_3: u32,
    effect_spell_class_mask3_1: u32,
    effect_spell_class_mask3_2: u32,
    effect_spell_class_mask3_3: u32,
    spell_visual: i32,
    spell_visual2: i32,
    spell_icon_id: i32,
    active_icon_id: i32,
    spell_priority: i32,

    spell_name: String,
    #[allow(unused)] // Data is always either null or empty string
    spell_name2: Option<String>,
    #[allow(unused)] // Data is always either null or empty string
    spell_name3: Option<String>,
    #[allow(unused)] // Data is always either null or empty string
    spell_name4: Option<String>,
    #[allow(unused)] // Data is always either null or empty string
    spell_name5: Option<String>,
    #[allow(unused)] // Data is always either null or empty string
    spell_name6: Option<String>,
    #[allow(unused)] // Data is always either null or empty string
    spell_name7: Option<String>,
    #[allow(unused)] // Data is always either null or empty string
    spell_name8: Option<String>,
    #[allow(unused)] // Data is always either null or empty string
    spell_name9: Option<String>,
    #[allow(unused)] // Data is always either null or empty string
    spell_name10: Option<String>,
    #[allow(unused)] // Data is always either null or empty string
    spell_name11: Option<String>,
    #[allow(unused)] // Data is always either null or empty string
    spell_name12: Option<String>,
    #[allow(unused)] // Data is always either null or empty string
    spell_name13: Option<String>,
    #[allow(unused)] // Data is always either null or empty string
    spell_name14: Option<String>,
    #[allow(unused)] // Data is always either null or empty string
    spell_name15: Option<String>,
    #[allow(unused)] // Data is always either null or empty string
    spell_name16: Option<String>,

    rank1: Option<String>,
    #[allow(unused)] // Data is always either null or empty string
    rank2: Option<String>,
    #[allow(unused)] // Data is always either null or empty string
    rank3: Option<String>,
    #[allow(unused)] // Data is always either null or empty string
    rank4: Option<String>,
    #[allow(unused)] // Data is always either null or empty string
    rank5: Option<String>,
    #[allow(unused)] // Data is always either null or empty string
    rank6: Option<String>,
    #[allow(unused)] // Data is always either null or empty string
    rank7: Option<String>,
    #[allow(unused)] // Data is always either null or empty string
    rank8: Option<String>,
    #[allow(unused)] // Data is always either null or empty string
    rank9: Option<String>,
    #[allow(unused)] // Data is always either null or empty string
    rank10: Option<String>,
    #[allow(unused)] // Data is always either null or empty string
    rank11: Option<String>,
    #[allow(unused)] // Data is always either null or empty string
    rank12: Option<String>,
    #[allow(unused)] // Data is always either null or empty string
    rank13: Option<String>,
    #[allow(unused)] // Data is always either null or empty string
    rank14: Option<String>,
    #[allow(unused)] // Data is always either null or empty string
    rank15: Option<String>,
    #[allow(unused)] // Data is always either null or empty string
    rank16: Option<String>,

    mana_cost_percentage: i32,
    start_recovery_category: i32,
    start_recovery_time: i32,
    max_target_level: i32,
    spell_family_name: i32,
    spell_family_flags: u64,
    spell_family_flags2: u32,
    max_affected_targets: i32,
    dmg_class: i32,
    prevention_type: i32,
    stance_bar_order: i32,
    dmg_multiplier1: f32,
    dmg_multiplier2: f32,
    dmg_multiplier3: f32,
    min_faction_id: i32,
    min_reputation: i32,
    required_aura_vision: i32,
    totem_category1: i32,
    totem_category2: i32,
    area_id: u32,
    school_mask: i32,
    rune_cost_id: u32,
    spell_missile_id: u32,
    power_display_id: u32,
    effect_bonus_coefficient1: f32,
    effect_bonus_coefficient2: f32,
    effect_bonus_coefficient3: f32,
    spell_description_variable_id: u32,
    spell_difficulty_id: u32,
    is_server_side: u32,
    attributes_serverside: i32,
}

impl WrathSpell {
    pub(crate) fn into_generic_spell(self) -> GenericThing {
        let fields = vec![
            Field::new("entry", Value::Uint(self.id)),
            Field::new("category", Value::Int(self.category)),
            Field::new("dispel", Value::Int(self.dispel)),
            Field::new("mechanic", Value::Int(self.mechanic)),
            Field::new("attributes", Value::Uint(self.attributes)),
            Field::new("attributes_ex", Value::Uint(self.attributes_ex)),
            Field::new("attributes_ex2", Value::Uint(self.attributes_ex2)),
            Field::new("attributes_ex3", Value::Uint(self.attributes_ex3)),
            Field::new("attributes_ex4", Value::Uint(self.attributes_ex4)),
            Field::new("attributes_ex5", Value::Uint(self.attributes_ex5)),
            Field::new("attributes_ex6", Value::Uint(self.attributes_ex6)),
            Field::new("attributes_ex7", Value::Uint(self.attributes_ex7)),
            Field::new("stances", Value::Uint(self.stances)),
            Field::new("stances2", Value::Uint(self.stances2)),
            Field::new("stances_not", Value::Uint(self.stances_not)),
            Field::new("stances_not2", Value::Uint(self.stances_not2)),
            Field::new("targets", Value::Int(self.targets)),
            Field::new(
                "target_creature_type",
                Value::Int(self.target_creature_type),
            ),
            Field::new(
                "requires_spell_focus",
                Value::Int(self.requires_spell_focus),
            ),
            Field::new("facing_caster_flags", Value::Int(self.facing_caster_flags)),
            Field::new("caster_aura_state", Value::Int(self.caster_aura_state)),
            Field::new("target_aura_state", Value::Int(self.target_aura_state)),
            Field::new(
                "caster_aura_state_not",
                Value::Int(self.caster_aura_state_not),
            ),
            Field::new(
                "target_aura_state_not",
                Value::Int(self.target_aura_state_not),
            ),
            Field::new("caster_aura_spell", Value::Int(self.caster_aura_spell)),
            Field::new("target_aura_spell", Value::Int(self.target_aura_spell)),
            Field::new(
                "exclude_caster_aura_spell",
                Value::Int(self.exclude_caster_aura_spell),
            ),
            Field::new(
                "exclude_target_aura_spell",
                Value::Int(self.exclude_target_aura_spell),
            ),
            Field::new("casting_time_index", Value::Int(self.casting_time_index)),
            Field::new("recovery_time", Value::Int(self.recovery_time)),
            Field::new(
                "category_recovery_time",
                Value::Int(self.category_recovery_time),
            ),
            Field::new("interrupt_flags", Value::Int(self.interrupt_flags)),
            Field::new(
                "aura_interrupt_flags",
                Value::Uint(self.aura_interrupt_flags),
            ),
            Field::new(
                "channel_interrupt_flags",
                Value::Uint(self.channel_interrupt_flags),
            ),
            Field::new("proc_flags", Value::Int(self.proc_flags)),
            Field::new("proc_chance", Value::Int(self.proc_chance)),
            Field::new("proc_charges", Value::Int(self.proc_charges)),
            Field::new("max_level", Value::Int(self.max_level)),
            Field::new("base_level", Value::Int(self.base_level)),
            Field::new("spell_level", Value::Int(self.spell_level)),
            Field::new("duration_index", Value::Int(self.duration_index)),
            Field::new("power_type", Value::Uint(self.power_type)),
            Field::new("mana_cost", Value::Int(self.mana_cost)),
            Field::new("mana_cost_per_level", Value::Int(self.mana_cost_per_level)),
            Field::new("mana_per_second", Value::Int(self.mana_per_second)),
            Field::new(
                "mana_per_second_per_level",
                Value::Int(self.mana_per_second_per_level),
            ),
            Field::new("range_index", Value::Int(self.range_index)),
            Field::new("speed", Value::Float(self.speed)),
            Field::new("modal_next_spell", Value::Int(self.modal_next_spell)),
            Field::new("stack_amount", Value::Int(self.stack_amount)),
            Field::new("equipped_item_class", Value::Int(self.equipped_item_class)),
            Field::new(
                "equipped_item_sub_class_mask",
                Value::Int(self.equipped_item_sub_class_mask),
            ),
            Field::new(
                "equipped_item_inventory_type_mask",
                Value::Int(self.equipped_item_inventory_type_mask),
            ),
            Field::new("spell_visual", Value::Int(self.spell_visual)),
            Field::new("spell_visual2", Value::Int(self.spell_visual2)),
            Field::new("spell_icon_id", Value::Int(self.spell_icon_id)),
            Field::new("active_icon_id", Value::Int(self.active_icon_id)),
            Field::new("spell_priority", Value::Int(self.spell_priority)),
            Field::new("spell_name", Value::String(self.spell_name.clone())),
            Field::new("rank_text", Value::String(self.rank1.unwrap_or_default())),
            Field::new(
                "mana_cost_percentage",
                Value::Int(self.mana_cost_percentage),
            ),
            Field::new(
                "start_recovery_category",
                Value::Int(self.start_recovery_category),
            ),
            Field::new("start_recovery_time", Value::Int(self.start_recovery_time)),
            Field::new("max_target_level", Value::Int(self.max_target_level)),
            Field::new("spell_family_name", Value::Int(self.spell_family_name)),
            Field::new("spell_family_flags", Value::Uint64(self.spell_family_flags)),
            Field::new("spell_family_flags2", Value::Uint(self.spell_family_flags2)),
            Field::new(
                "max_affected_targets",
                Value::Int(self.max_affected_targets),
            ),
            Field::new("dmg_class", Value::Int(self.dmg_class)),
            Field::new("prevention_type", Value::Int(self.prevention_type)),
            Field::new("stance_bar_order", Value::Int(self.stance_bar_order)),
            Field::new("min_faction_id", Value::Int(self.min_faction_id)),
            Field::new("min_reputation", Value::Int(self.min_reputation)),
            Field::new(
                "required_aura_vision",
                Value::Int(self.required_aura_vision),
            ),
            Field::new("area_id", Value::Uint(self.area_id)),
            Field::new("school_mask", Value::Int(self.school_mask)),
            Field::new("rune_cost_id", Value::Uint(self.rune_cost_id)),
            Field::new("spell_missile_id", Value::Uint(self.spell_missile_id)),
            Field::new("power_display_id", Value::Uint(self.power_display_id)),
            Field::new(
                "spell_description_variable_id",
                Value::Uint(self.spell_description_variable_id),
            ),
            Field::new("spell_difficulty_id", Value::Uint(self.spell_difficulty_id)),
            Field::new("is_server_side", Value::Uint(self.is_server_side)),
            Field::new(
                "attributes_serverside",
                Value::Int(self.attributes_serverside),
            ),
        ];

        let arrays = vec![
            Array::new(
                "reagents",
                "Reagent",
                false,
                vec![
                    vec![
                        ArrayField::new("reagent", "reagent1", Value::Int(self.reagent1)),
                        ArrayField::new(
                            "amount",
                            "reagent_count1",
                            Value::Uint(self.reagent_count1),
                        ),
                    ],
                    vec![
                        ArrayField::new("reagent", "reagent2", Value::Int(self.reagent2)),
                        ArrayField::new(
                            "amount",
                            "reagent_count2",
                            Value::Uint(self.reagent_count2),
                        ),
                    ],
                    vec![
                        ArrayField::new("reagent", "reagent3", Value::Int(self.reagent3)),
                        ArrayField::new(
                            "amount",
                            "reagent_count3",
                            Value::Uint(self.reagent_count3),
                        ),
                    ],
                    vec![
                        ArrayField::new("reagent", "reagent4", Value::Int(self.reagent4)),
                        ArrayField::new(
                            "amount",
                            "reagent_count4",
                            Value::Uint(self.reagent_count4),
                        ),
                    ],
                    vec![
                        ArrayField::new("reagent", "reagent5", Value::Int(self.reagent5)),
                        ArrayField::new(
                            "amount",
                            "reagent_count5",
                            Value::Uint(self.reagent_count5),
                        ),
                    ],
                    vec![
                        ArrayField::new("reagent", "reagent6", Value::Int(self.reagent6)),
                        ArrayField::new(
                            "amount",
                            "reagent_count6",
                            Value::Uint(self.reagent_count6),
                        ),
                    ],
                    vec![
                        ArrayField::new("reagent", "reagent7", Value::Int(self.reagent7)),
                        ArrayField::new(
                            "amount",
                            "reagent_count7",
                            Value::Uint(self.reagent_count7),
                        ),
                    ],
                    vec![
                        ArrayField::new("reagent", "reagent8", Value::Int(self.reagent8)),
                        ArrayField::new(
                            "amount",
                            "reagent_count8",
                            Value::Uint(self.reagent_count8),
                        ),
                    ],
                ],
            ),
            Array::new(
                "effects",
                "SpellEffects",
                false,
                vec![
                    vec![
                        ArrayField::new("effect", "effect1", Value::Int(self.effect1)),
                        ArrayField::new(
                            "die_sides",
                            "effect_die_sides1",
                            Value::Int(self.effect_die_sides1),
                        ),
                        ArrayField::new(
                            "real_points_per_level",
                            "effect_real_points_per_level1",
                            Value::Float(self.effect_real_points_per_level1),
                        ),
                        ArrayField::new(
                            "base_points",
                            "effect_base_points1",
                            Value::Int(self.effect_base_points1),
                        ),
                        ArrayField::new(
                            "mechanics",
                            "effect_mechanic1",
                            Value::Int(self.effect_mechanic1),
                        ),
                        ArrayField::new(
                            "implicit_target_a",
                            "effect_implicit_target_a1",
                            Value::Int(self.effect_implicit_target_a1),
                        ),
                        ArrayField::new(
                            "implicit_target_b",
                            "effect_implicit_target_b1",
                            Value::Int(self.effect_implicit_target_b1),
                        ),
                        ArrayField::new(
                            "radius_index",
                            "effect_radius_index1",
                            Value::Int(self.effect_radius_index1),
                        ),
                        ArrayField::new(
                            "apply_aura_name",
                            "effect_apply_aura_name1",
                            Value::Int(self.effect_apply_aura_name1),
                        ),
                        ArrayField::new(
                            "amplitude",
                            "effect_amplitude1",
                            Value::Int(self.effect_amplitude1),
                        ),
                        ArrayField::new(
                            "multiple_value",
                            "effect_multiple_value1",
                            Value::Float(self.effect_multiple_value1),
                        ),
                        ArrayField::new(
                            "chain_target",
                            "effect_chain_target1",
                            Value::Int(self.effect_chain_target1),
                        ),
                        ArrayField::new(
                            "item_type",
                            "effect_item_type1",
                            Value::Uint(self.effect_item_type1),
                        ),
                        ArrayField::new(
                            "misc_value",
                            "effect_misc_value1",
                            Value::Int(self.effect_misc_value1),
                        ),
                        ArrayField::new(
                            "misc_value_b",
                            "effect_misc_value_b1",
                            Value::Int(self.effect_misc_value_b1),
                        ),
                        ArrayField::new(
                            "trigger_spell",
                            "effect_trigger_spell1",
                            Value::Uint(self.effect_trigger_spell1),
                        ),
                        ArrayField::new(
                            "points_per_combo_point",
                            "effect_points_per_combo_point1",
                            Value::Float(self.effect_points_per_combo_point1),
                        ),
                        ArrayField::new(
                            "spell_class_mask1",
                            "effect_spell_class_mask1_1",
                            Value::Uint(self.effect_spell_class_mask1_1),
                        ),
                        ArrayField::new(
                            "spell_class_mask2",
                            "effect_spell_class_mask1_2",
                            Value::Uint(self.effect_spell_class_mask1_2),
                        ),
                        ArrayField::new(
                            "spell_class_mask3",
                            "effect_spell_class_mask1_3",
                            Value::Uint(self.effect_spell_class_mask1_3),
                        ),
                        ArrayField::new(
                            "damage_multiplier",
                            "dmg_multiplier1",
                            Value::Float(self.dmg_multiplier1),
                        ),
                        ArrayField::new(
                            "bonus_coefficient",
                            "effect_bonus_coefficient1",
                            Value::Float(self.effect_bonus_coefficient1),
                        ),
                    ],
                    vec![
                        ArrayField::new("effect", "effect2", Value::Int(self.effect2)),
                        ArrayField::new(
                            "die_sides",
                            "effect_die_sides2",
                            Value::Int(self.effect_die_sides2),
                        ),
                        ArrayField::new(
                            "real_points_per_level",
                            "effect_real_points_per_level2",
                            Value::Float(self.effect_real_points_per_level2),
                        ),
                        ArrayField::new(
                            "base_points",
                            "effect_base_points2",
                            Value::Int(self.effect_base_points2),
                        ),
                        ArrayField::new(
                            "mechanics",
                            "effect_mechanic2",
                            Value::Int(self.effect_mechanic2),
                        ),
                        ArrayField::new(
                            "implicit_target_a",
                            "effect_implicit_target_a2",
                            Value::Int(self.effect_implicit_target_a2),
                        ),
                        ArrayField::new(
                            "implicit_target_b",
                            "effect_implicit_target_b2",
                            Value::Int(self.effect_implicit_target_b2),
                        ),
                        ArrayField::new(
                            "radius_index",
                            "effect_radius_index2",
                            Value::Int(self.effect_radius_index2),
                        ),
                        ArrayField::new(
                            "apply_aura_name",
                            "effect_apply_aura_name2",
                            Value::Int(self.effect_apply_aura_name2),
                        ),
                        ArrayField::new(
                            "amplitude",
                            "effect_amplitude2",
                            Value::Int(self.effect_amplitude2),
                        ),
                        ArrayField::new(
                            "multiple_value",
                            "effect_multiple_value2",
                            Value::Float(self.effect_multiple_value2),
                        ),
                        ArrayField::new(
                            "chain_target",
                            "effect_chain_target2",
                            Value::Int(self.effect_chain_target2),
                        ),
                        ArrayField::new(
                            "item_type",
                            "effect_item_type2",
                            Value::Uint(self.effect_item_type2),
                        ),
                        ArrayField::new(
                            "misc_value",
                            "effect_misc_value2",
                            Value::Int(self.effect_misc_value2),
                        ),
                        ArrayField::new(
                            "misc_value_b",
                            "effect_misc_value_b2",
                            Value::Int(self.effect_misc_value_b2),
                        ),
                        ArrayField::new(
                            "trigger_spell",
                            "effect_trigger_spell2",
                            Value::Uint(self.effect_trigger_spell2),
                        ),
                        ArrayField::new(
                            "points_per_combo_point",
                            "effect_points_per_combo_point2",
                            Value::Float(self.effect_points_per_combo_point2),
                        ),
                        ArrayField::new(
                            "spell_class_mask1",
                            "effect_spell_class_mask2_1",
                            Value::Uint(self.effect_spell_class_mask2_1),
                        ),
                        ArrayField::new(
                            "spell_class_mask2",
                            "effect_spell_class_mask2_2",
                            Value::Uint(self.effect_spell_class_mask2_2),
                        ),
                        ArrayField::new(
                            "spell_class_mask3",
                            "effect_spell_class_mask2_3",
                            Value::Uint(self.effect_spell_class_mask2_3),
                        ),
                        ArrayField::new(
                            "damage_multiplier",
                            "dmg_multiplier2",
                            Value::Float(self.dmg_multiplier2),
                        ),
                        ArrayField::new(
                            "bonus_coefficient",
                            "effect_bonus_coefficient2",
                            Value::Float(self.effect_bonus_coefficient2),
                        ),
                    ],
                    vec![
                        ArrayField::new("effect", "effect3", Value::Int(self.effect3)),
                        ArrayField::new(
                            "die_sides",
                            "effect_die_sides3",
                            Value::Int(self.effect_die_sides3),
                        ),
                        ArrayField::new(
                            "real_points_per_level",
                            "effect_real_points_per_level3",
                            Value::Float(self.effect_real_points_per_level3),
                        ),
                        ArrayField::new(
                            "base_points",
                            "effect_base_points3",
                            Value::Int(self.effect_base_points3),
                        ),
                        ArrayField::new(
                            "mechanics",
                            "effect_mechanic3",
                            Value::Int(self.effect_mechanic3),
                        ),
                        ArrayField::new(
                            "implicit_target_a",
                            "effect_implicit_target_a3",
                            Value::Int(self.effect_implicit_target_a3),
                        ),
                        ArrayField::new(
                            "implicit_target_b",
                            "effect_implicit_target_b3",
                            Value::Int(self.effect_implicit_target_b3),
                        ),
                        ArrayField::new(
                            "radius_index",
                            "effect_radius_index3",
                            Value::Int(self.effect_radius_index3),
                        ),
                        ArrayField::new(
                            "apply_aura_name",
                            "effect_apply_aura_name3",
                            Value::Int(self.effect_apply_aura_name3),
                        ),
                        ArrayField::new(
                            "amplitude",
                            "effect_amplitude3",
                            Value::Int(self.effect_amplitude3),
                        ),
                        ArrayField::new(
                            "multiple_value",
                            "effect_multiple_value3",
                            Value::Float(self.effect_multiple_value3),
                        ),
                        ArrayField::new(
                            "chain_target",
                            "effect_chain_target3",
                            Value::Int(self.effect_chain_target3),
                        ),
                        ArrayField::new(
                            "item_type",
                            "effect_item_type3",
                            Value::Uint(self.effect_item_type3),
                        ),
                        ArrayField::new(
                            "misc_value",
                            "effect_misc_value3",
                            Value::Int(self.effect_misc_value3),
                        ),
                        ArrayField::new(
                            "misc_value_b",
                            "effect_misc_value_b3",
                            Value::Int(self.effect_misc_value_b3),
                        ),
                        ArrayField::new(
                            "trigger_spell",
                            "effect_trigger_spell3",
                            Value::Uint(self.effect_trigger_spell3),
                        ),
                        ArrayField::new(
                            "points_per_combo_point",
                            "effect_points_per_combo_point3",
                            Value::Float(self.effect_points_per_combo_point3),
                        ),
                        ArrayField::new(
                            "spell_class_mask1",
                            "effect_spell_class_mask3_1",
                            Value::Uint(self.effect_spell_class_mask3_1),
                        ),
                        ArrayField::new(
                            "spell_class_mask2",
                            "effect_spell_class_mask3_2",
                            Value::Uint(self.effect_spell_class_mask3_2),
                        ),
                        ArrayField::new(
                            "spell_class_mask3",
                            "effect_spell_class_mask3_3",
                            Value::Uint(self.effect_spell_class_mask3_3),
                        ),
                        ArrayField::new(
                            "damage_multiplier",
                            "dmg_multiplier3",
                            Value::Float(self.dmg_multiplier3),
                        ),
                        ArrayField::new(
                            "bonus_coefficient",
                            "effect_bonus_coefficient3",
                            Value::Float(self.effect_bonus_coefficient3),
                        ),
                    ],
                ],
            ),
            Array::new(
                "totems",
                "Totem",
                false,
                vec![
                    vec![ArrayField::new("totem", "totem1", Value::Int(self.totem1))],
                    vec![ArrayField::new("totem", "totem2", Value::Int(self.totem2))],
                ],
            ),
            Array::new(
                "totem_categories",
                "TotemCategory",
                false,
                vec![
                    vec![ArrayField::new(
                        "category",
                        "totem_category1",
                        Value::Int(self.totem_category1),
                    )],
                    vec![ArrayField::new(
                        "category",
                        "totem_category2",
                        Value::Int(self.totem_category2),
                    )],
                ],
            ),
        ];

        GenericThing {
            entry: self.id,
            extra_flags: 0,
            name: self.spell_name,
            fields,
            arrays,
        }
    }
}

pub(crate) fn wrath(conn: &Connection) -> (Vec<GenericThing>, Optimizations) {
    assertions(conn);

    let mut s = conn
        .prepare(
            "SELECT
    Id,
    Category,
    Dispel,
    Mechanic,
    Attributes,
    AttributesEx,
    AttributesEx2,
    AttributesEx3,
    AttributesEx4,
    AttributesEx5,
    AttributesEx6,
    AttributesEx7,
    Stances,
    Stances2,
    StancesNot,
    StancesNot2,
    Targets,
    TargetCreatureType,
    RequiresSpellFocus,
    FacingCasterFlags,
    CasterAuraState,
    TargetAuraState,
    CasterAuraStateNot,
    TargetAuraStateNot,
    CasterAuraSpell,
    TargetAuraSpell,
    ExcludeCasterAuraSpell,
    ExcludeTargetAuraSpell,
    CastingTimeIndex,
    RecoveryTime,
    CategoryRecoveryTime,
    InterruptFlags,
    AuraInterruptFlags,
    ChannelInterruptFlags,
    ProcFlags,
    ProcChance,
    ProcCharges,
    MaxLevel,
    BaseLevel,
    SpellLevel,
    DurationIndex,
    PowerType,
    ManaCost,
    ManaCostPerlevel,
    ManaPerSecond,
    ManaPerSecondPerLevel,
    RangeIndex,
    Speed,
    ModalNextSpell,
    StackAmount,
    Totem1,
    Totem2,
    Reagent1,
    Reagent2,
    Reagent3,
    Reagent4,
    Reagent5,
    Reagent6,
    Reagent7,
    Reagent8,
    ReagentCount1,
    ReagentCount2,
    ReagentCount3,
    ReagentCount4,
    ReagentCount5,
    ReagentCount6,
    ReagentCount7,
    ReagentCount8,
    EquippedItemClass,
    EquippedItemSubClassMask,
    EquippedItemInventoryTypeMask,
    Effect1,
    Effect2,
    Effect3,
    EffectDieSides1,
    EffectDieSides2,
    EffectDieSides3,
    EffectRealPointsPerLevel1,
    EffectRealPointsPerLevel2,
    EffectRealPointsPerLevel3,
    EffectBasePoints1,
    EffectBasePoints2,
    EffectBasePoints3,
    EffectMechanic1,
    EffectMechanic2,
    EffectMechanic3,
    EffectImplicitTargetA1,
    EffectImplicitTargetA2,
    EffectImplicitTargetA3,
    EffectImplicitTargetB1,
    EffectImplicitTargetB2,
    EffectImplicitTargetB3,
    EffectRadiusIndex1,
    EffectRadiusIndex2,
    EffectRadiusIndex3,
    EffectApplyAuraName1,
    EffectApplyAuraName2,
    EffectApplyAuraName3,
    EffectAmplitude1,
    EffectAmplitude2,
    EffectAmplitude3,
    EffectMultipleValue1,
    EffectMultipleValue2,
    EffectMultipleValue3,
    EffectChainTarget1,
    EffectChainTarget2,
    EffectChainTarget3,
    EffectItemType1,
    EffectItemType2,
    EffectItemType3,
    EffectMiscValue1,
    EffectMiscValue2,
    EffectMiscValue3,
    EffectMiscValueB1,
    EffectMiscValueB2,
    EffectMiscValueB3,
    EffectTriggerSpell1,
    EffectTriggerSpell2,
    EffectTriggerSpell3,
    EffectPointsPerComboPoint1,
    EffectPointsPerComboPoint2,
    EffectPointsPerComboPoint3,
    EffectSpellClassMask1_1,
    EffectSpellClassMask1_2,
    EffectSpellClassMask1_3,
    EffectSpellClassMask2_1,
    EffectSpellClassMask2_2,
    EffectSpellClassMask2_3,
    EffectSpellClassMask3_1,
    EffectSpellClassMask3_2,
    EffectSpellClassMask3_3,
    SpellVisual,
    SpellVisual2,
    SpellIconID,
    ActiveIconID,
    SpellPriority,
    SpellName,
    SpellName2,
    SpellName3,
    SpellName4,
    SpellName5,
    SpellName6,
    SpellName7,
    SpellName8,
    SpellName9,
    SpellName10,
    SpellName11,
    SpellName12,
    SpellName13,
    SpellName14,
    SpellName15,
    SpellName16,
    Rank1,
    Rank2,
    Rank3,
    Rank4,
    Rank5,
    Rank6,
    Rank7,
    Rank8,
    Rank9,
    Rank10,
    Rank11,
    Rank12,
    Rank13,
    Rank14,
    Rank15,
    Rank16,
    ManaCostPercentage,
    StartRecoveryCategory,
    StartRecoveryTime,
    MaxTargetLevel,
    SpellFamilyName,
    SpellFamilyFlags,
    SpellFamilyFlags2,
    MaxAffectedTargets,
    DmgClass,
    PreventionType,
    StanceBarOrder,
    DmgMultiplier1,
    DmgMultiplier2,
    DmgMultiplier3,
    MinFactionId,
    MinReputation,
    RequiredAuraVision,
    TotemCategory1,
    TotemCategory2,
    AreaId,
    SchoolMask,
    RuneCostID,
    SpellMissileID,
    PowerDisplayId,
    EffectBonusCoefficient1,
    EffectBonusCoefficient2,
    EffectBonusCoefficient3,
    SpellDescriptionVariableID,
    SpellDifficultyId,
    IsServerSide,
    AttributesServerside
    FROM spell_template ORDER BY Id;",
        )
        .unwrap();

    let r = s
        .query_map([], |row| {
            Ok(WrathSpell {
                id: row.get(0).unwrap(),
                category: row.get(1).unwrap(),
                dispel: row.get(2).unwrap(),
                mechanic: row.get(3).unwrap(),
                attributes: row.get(4).unwrap(),
                attributes_ex: row.get(5).unwrap(),
                attributes_ex2: row.get(6).unwrap(),
                attributes_ex3: row.get(7).unwrap(),
                attributes_ex4: row.get(8).unwrap(),
                attributes_ex5: row.get(9).unwrap(),
                attributes_ex6: row.get(10).unwrap(),
                attributes_ex7: row.get(11).unwrap(),
                stances: row.get(12).unwrap(),
                stances2: row.get(13).unwrap(),
                stances_not: row.get(14).unwrap(),
                stances_not2: row.get(15).unwrap(),
                targets: row.get(16).unwrap(),
                target_creature_type: row.get(17).unwrap(),
                requires_spell_focus: row.get(18).unwrap(),
                facing_caster_flags: row.get(19).unwrap(),
                caster_aura_state: row.get(20).unwrap(),
                target_aura_state: row.get(21).unwrap(),
                caster_aura_state_not: row.get(22).unwrap(),
                target_aura_state_not: row.get(23).unwrap(),
                caster_aura_spell: row.get(24).unwrap(),
                target_aura_spell: row.get(25).unwrap(),
                exclude_caster_aura_spell: row.get(26).unwrap(),
                exclude_target_aura_spell: row.get(27).unwrap(),
                casting_time_index: row.get(28).unwrap(),
                recovery_time: row.get(29).unwrap(),
                category_recovery_time: row.get(30).unwrap(),
                interrupt_flags: row.get(31).unwrap(),
                aura_interrupt_flags: row.get(32).unwrap(),
                channel_interrupt_flags: row.get(33).unwrap(),
                proc_flags: row.get(34).unwrap(),
                proc_chance: row.get(35).unwrap(),
                proc_charges: row.get(36).unwrap(),
                max_level: row.get(37).unwrap(),
                base_level: row.get(38).unwrap(),
                spell_level: row.get(39).unwrap(),
                duration_index: row.get(40).unwrap(),
                power_type: row.get(41).unwrap(),
                mana_cost: row.get(42).unwrap(),
                mana_cost_per_level: row.get(43).unwrap(),
                mana_per_second: row.get(44).unwrap(),
                mana_per_second_per_level: row.get(45).unwrap(),
                range_index: row.get(46).unwrap(),
                speed: row.get(47).unwrap(),
                modal_next_spell: row.get(48).unwrap(),
                stack_amount: row.get(49).unwrap(),
                totem1: row.get(50).unwrap(),
                totem2: row.get(51).unwrap(),
                reagent1: row.get(52).unwrap(),
                reagent2: row.get(53).unwrap(),
                reagent3: row.get(54).unwrap(),
                reagent4: row.get(55).unwrap(),
                reagent5: row.get(56).unwrap(),
                reagent6: row.get(57).unwrap(),
                reagent7: row.get(58).unwrap(),
                reagent8: row.get(59).unwrap(),
                reagent_count1: row.get(60).unwrap(),
                reagent_count2: row.get(61).unwrap(),
                reagent_count3: row.get(62).unwrap(),
                reagent_count4: row.get(63).unwrap(),
                reagent_count5: row.get(64).unwrap(),
                reagent_count6: row.get(65).unwrap(),
                reagent_count7: row.get(66).unwrap(),
                reagent_count8: row.get(67).unwrap(),
                equipped_item_class: row.get(68).unwrap(),
                equipped_item_sub_class_mask: row.get(69).unwrap(),
                equipped_item_inventory_type_mask: row.get(70).unwrap(),
                effect1: row.get(71).unwrap(),
                effect2: row.get(72).unwrap(),
                effect3: row.get(73).unwrap(),
                effect_die_sides1: row.get(74).unwrap(),
                effect_die_sides2: row.get(75).unwrap(),
                effect_die_sides3: row.get(76).unwrap(),
                effect_real_points_per_level1: row.get(77).unwrap(),
                effect_real_points_per_level2: row.get(78).unwrap(),
                effect_real_points_per_level3: row.get(79).unwrap(),
                effect_base_points1: row.get(80).unwrap(),
                effect_base_points2: row.get(81).unwrap(),
                effect_base_points3: row.get(82).unwrap(),
                effect_mechanic1: row.get(83).unwrap(),
                effect_mechanic2: row.get(84).unwrap(),
                effect_mechanic3: row.get(85).unwrap(),
                effect_implicit_target_a1: row.get(86).unwrap(),
                effect_implicit_target_a2: row.get(87).unwrap(),
                effect_implicit_target_a3: row.get(88).unwrap(),
                effect_implicit_target_b1: row.get(89).unwrap(),
                effect_implicit_target_b2: row.get(90).unwrap(),
                effect_implicit_target_b3: row.get(91).unwrap(),
                effect_radius_index1: row.get(92).unwrap(),
                effect_radius_index2: row.get(93).unwrap(),
                effect_radius_index3: row.get(94).unwrap(),
                effect_apply_aura_name1: row.get(95).unwrap(),
                effect_apply_aura_name2: row.get(96).unwrap(),
                effect_apply_aura_name3: row.get(97).unwrap(),
                effect_amplitude1: row.get(98).unwrap(),
                effect_amplitude2: row.get(99).unwrap(),
                effect_amplitude3: row.get(100).unwrap(),
                effect_multiple_value1: row.get(101).unwrap(),
                effect_multiple_value2: row.get(102).unwrap(),
                effect_multiple_value3: row.get(103).unwrap(),
                effect_chain_target1: row.get(104).unwrap(),
                effect_chain_target2: row.get(105).unwrap(),
                effect_chain_target3: row.get(106).unwrap(),
                effect_item_type1: row.get(107).unwrap(),
                effect_item_type2: row.get(108).unwrap(),
                effect_item_type3: row.get(109).unwrap(),
                effect_misc_value1: row.get(110).unwrap(),
                effect_misc_value2: row.get(111).unwrap(),
                effect_misc_value3: row.get(112).unwrap(),
                effect_misc_value_b1: row.get(113).unwrap(),
                effect_misc_value_b2: row.get(114).unwrap(),
                effect_misc_value_b3: row.get(115).unwrap(),
                effect_trigger_spell1: row.get(116).unwrap(),
                effect_trigger_spell2: row.get(117).unwrap(),
                effect_trigger_spell3: row.get(118).unwrap(),
                effect_points_per_combo_point1: row.get(119).unwrap(),
                effect_points_per_combo_point2: row.get(120).unwrap(),
                effect_points_per_combo_point3: row.get(121).unwrap(),
                effect_spell_class_mask1_1: row.get(122).unwrap(),
                effect_spell_class_mask1_2: row.get(123).unwrap(),
                effect_spell_class_mask1_3: row.get(124).unwrap(),
                effect_spell_class_mask2_1: row.get(125).unwrap(),
                effect_spell_class_mask2_2: row.get(126).unwrap(),
                effect_spell_class_mask2_3: row.get(127).unwrap(),
                effect_spell_class_mask3_1: row.get(128).unwrap(),
                effect_spell_class_mask3_2: row.get(129).unwrap(),
                effect_spell_class_mask3_3: row.get(130).unwrap(),
                spell_visual: row.get(131).unwrap(),
                spell_visual2: row.get(132).unwrap(),
                spell_icon_id: row.get(133).unwrap(),
                active_icon_id: row.get(134).unwrap(),
                spell_priority: row.get(135).unwrap(),
                spell_name: row.get(136).unwrap(),
                spell_name2: row.get(137).unwrap(),
                spell_name3: row.get(138).unwrap(),
                spell_name4: row.get(139).unwrap(),
                spell_name5: row.get(140).unwrap(),
                spell_name6: row.get(141).unwrap(),
                spell_name7: row.get(142).unwrap(),
                spell_name8: row.get(143).unwrap(),
                spell_name9: row.get(144).unwrap(),
                spell_name10: row.get(145).unwrap(),
                spell_name11: row.get(146).unwrap(),
                spell_name12: row.get(147).unwrap(),
                spell_name13: row.get(148).unwrap(),
                spell_name14: row.get(149).unwrap(),
                spell_name15: row.get(150).unwrap(),
                spell_name16: row.get(151).unwrap(),
                rank1: row.get(152).unwrap(),
                rank2: row.get(153).unwrap(),
                rank3: row.get(154).unwrap(),
                rank4: row.get(155).unwrap(),
                rank5: row.get(156).unwrap(),
                rank6: row.get(157).unwrap(),
                rank7: row.get(158).unwrap(),
                rank8: row.get(159).unwrap(),
                rank9: row.get(160).unwrap(),
                rank10: row.get(161).unwrap(),
                rank11: row.get(162).unwrap(),
                rank12: row.get(163).unwrap(),
                rank13: row.get(164).unwrap(),
                rank14: row.get(165).unwrap(),
                rank15: row.get(166).unwrap(),
                rank16: row.get(167).unwrap(),
                mana_cost_percentage: row.get(168).unwrap(),
                start_recovery_category: row.get(169).unwrap(),
                start_recovery_time: row.get(170).unwrap(),
                max_target_level: row.get(171).unwrap(),
                spell_family_name: row.get(172).unwrap(),
                spell_family_flags: {
                    match row.get::<usize, u64>(173) {
                        Ok(e) => e,
                        Err(_) => {
                            let a = row.get::<usize, f64>(173).unwrap();
                            // Rusqlite thinks it's a 'Real' for some reason
                            u64::from_le_bytes(a.to_le_bytes())
                        }
                    }
                },
                spell_family_flags2: row.get(174).unwrap(),
                max_affected_targets: row.get(175).unwrap(),
                dmg_class: row.get(176).unwrap(),
                prevention_type: row.get(177).unwrap(),
                stance_bar_order: row.get(178).unwrap(),
                dmg_multiplier1: row.get(179).unwrap(),
                dmg_multiplier2: row.get(180).unwrap(),
                dmg_multiplier3: row.get(181).unwrap(),
                min_faction_id: row.get(182).unwrap(),
                min_reputation: row.get(183).unwrap(),
                required_aura_vision: row.get(184).unwrap(),
                totem_category1: row.get(185).unwrap(),
                totem_category2: row.get(186).unwrap(),
                area_id: row.get(187).unwrap(),
                school_mask: row.get(188).unwrap(),
                rune_cost_id: row.get(189).unwrap(),
                spell_missile_id: row.get(190).unwrap(),
                power_display_id: row.get(191).unwrap(),
                effect_bonus_coefficient1: row.get(192).unwrap(),
                effect_bonus_coefficient2: row.get(193).unwrap(),
                effect_bonus_coefficient3: row.get(194).unwrap(),
                spell_description_variable_id: row.get(195).unwrap(),
                spell_difficulty_id: row.get(196).unwrap(),
                is_server_side: row.get(197).unwrap(),
                attributes_serverside: row.get(198).unwrap(),
            })
        })
        .unwrap();

    let spells: Vec<_> = r.map(|a| a.unwrap().into_generic_spell()).collect();
    let optimizations = Optimizations::new(&spells);
    (spells, optimizations)
}
